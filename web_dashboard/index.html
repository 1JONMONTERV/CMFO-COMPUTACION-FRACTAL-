<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CMFO Fractal Omniverse</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Courier New', Courier, monospace;
        }

        #graph {
            width: 100vw;
            height: 100vh;
        }

        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            color: #0ff;
            pointer-events: none;
            /* Let clicks pass through to graph */
        }

        h1 {
            margin: 0;
            font-size: 24px;
            text-shadow: 0 0 10px #0ff;
            pointer-events: auto;
        }

        #stats {
            font-size: 14px;
            color: #888;
            margin-top: 5px;
        }

        #controls {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 10;
        }

        button {
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid #0ff;
            color: #0ff;
            padding: 15px 30px;
            font-size: 18px;
            font-family: inherit;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.2s;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }

        button:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
        }

        button:active {
            transform: scale(0.95);
        }

        #log {
            position: absolute;
            bottom: 30px;
            left: 20px;
            color: #0f0;
            font-size: 12px;
            max-width: 400px;
            pointer-events: none;
        }
    </style>
    <!-- Import 3d-force-graph -->
    <script src="https://unpkg.com/3d-force-graph"></script>
</head>

<body>

    <div id="ui-layer">
        <h1>FRACTAL OMNIVERSE v1.0</h1>
        <div id="stats">Connected to JIT Core | 7-Dimensional Manifold</div>
    </div>

    <div id="log">System Ready...</div>

    <div id="controls">
        <button id="dream-btn" onclick="triggerDream()">INITIATE DREAM CYCLE</button>
    </div>

    <div id="graph"></div>

    <script>
        const LOG_EL = document.getElementById('log');

        // Initialize Graph
        const Graph = ForceGraph3D()
            (document.getElementById('graph'))
            .jsonUrl('/api/graph')
            .nodeAutoColorBy('group')
            .nodeLabel('id')
            .linkDirectionalParticles(2)
            .linkDirectionalParticleSpeed(d => d.value * 0.01)
            .linkOpacity(0.3)
            .backgroundColor('#000005');

        // Customize appearance
        Graph.nodeThreeObject(node => {
            // Use Three.js formatting if desired, or stick to simple spheres
            // For 'Fractal Glass' look, we rely on the glowing particles
        });

        function log(msg) {
            LOG_EL.innerHTML = `> ${msg}<br>` + LOG_EL.innerHTML;
        }

        async function triggerDream() {
            const btn = document.getElementById('dream-btn');
            btn.disabled = true;
            btn.innerText = "DREAMING...";

            log("Sending vector to JIT Kernel...");

            try {
                const res = await fetch('/api/dream', { method: 'POST' });
                const data = await res.json();

                if (data.status === 'success') {
                    const d = data.dream;
                    log(`DREAM COMPLETE: ${d.parents[0]} + ${d.parents[1]} => [${d.result}]`);
                    log(`Resonance: ${d.resonance}`);

                    // Refresh Graph Data
                    reloadGraph();
                } else {
                    log(`ERROR: ${data.message}`);
                }
            } catch (e) {
                log(`CONNECTION ERROR: Is server running?`);
            }

            btn.disabled = false;
            btn.innerText = "INITIATE DREAM CYCLE";
        }

        function reloadGraph() {
            // Re-fetching the jsonUrl
            // ForceGraph doesn't have a simple 'reload', so we re-set the data url
            // or we could fetch manually and use .graphData()
            // Simple hack: append timestamp
            Graph.jsonUrl(`/api/graph?t=${Date.now()}`);
        }

        // Auto-rotate camera
        let angle = 0;
        setInterval(() => {
            Graph.cameraPosition({
                x: 500 * Math.cos(angle),
                z: 500 * Math.sin(angle)
            });
            angle += 0.001;
        }, 10);

    </script>
</body>

</html>